var AuraChatbot=(()=>{var g=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var M=(r,n)=>{for(var l in n)g(r,l,{get:n[l],enumerable:!0})},O=(r,n,l,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of L(n))!I.call(r,o)&&o!==l&&g(r,o,{get:()=>n[o],enumerable:!(i=B(n,o))||i.enumerable});return r};var j=r=>O(g({},"__esModule",{value:!0}),r);var P={};M(P,{default:()=>H});var N={restUrl:"",nonce:"",selectors:{form:"[data-aura-form]",input:"[data-aura-input]",submit:"[data-aura-submit]",messages:"[data-aura-messages]",openBtn:"[data-aura-open]",closeBtn:"[data-aura-close]",typingIndicator:"[data-aura-typing]"},i18n:{sending:"Sending\u2026",error:"An error occurred. Please try again.",placeholder:"Ask about this product..."},requestTimeout:3e4};function d(r,n={},l=""){let i=document.createElement(r);return Object.entries(n).forEach(([o,c])=>{o==="class"?i.className=c:(o==="type"||o==="placeholder"||o==="value"||o.startsWith("aria")||o.startsWith("data-"))&&i.setAttribute(o,c)}),l&&(i.textContent=l),i}function U(r,n={},l=3e4){let i=new AbortController,o=setTimeout(()=>i.abort(),l),c=i.signal;return fetch(r,{...n,signal:c}).finally(()=>clearTimeout(o))}function _(r){let n=document.createElement("div");return n.textContent=r,n.innerHTML}var E=function(){let r={...N},n={container:null,elements:{}};function l(e){r=i(r,e||{})}function i(e,t){if(!t)return e;let a={...e};return Object.keys(t).forEach(s=>{o(t[s])&&o(e[s])?a[s]=i(e[s],t[s]):a[s]=t[s]}),a}function o(e){return e&&typeof e=="object"&&!Array.isArray(e)}function c(e,t,a="bot"){let s=d("div",{class:`aura-msg aura-msg--${a}`,role:"article"}),u=d("div",{class:"aura-msg__body"});u.innerHTML=_(t),s.appendChild(u),e.appendChild(s),e.scrollTop=e.scrollHeight}function y(e,t=!0){e&&(e.style.display=t?"":"none")}async function h(e){let t=r.restUrl;if(!t)throw new Error("Missing restUrl in configuration");let a={"Content-Type":"application/json"};r.nonce&&(a["X-WP-Nonce"]=r.nonce);let s=await U(t,{method:"POST",headers:a,body:JSON.stringify(e)},r.requestTimeout);if(!s.ok){let u=await s.text().catch(()=>"");throw new Error(`Network error ${s.status}: ${u}`)}return s.json()}function S(){let{form:e,input:t,submit:a,messages:s,typingIndicator:u,openBtn:m,closeBtn:C}=n.elements;e&&(e.addEventListener("submit",async p=>{p.preventDefault();let A=t.value.trim();if(!A)return;let v=A;t.value="",c(s,v,"user"),y(u,!0);try{let f=await h({prompt:v,context:b()});y(u,!1),f&&f.reply?c(s,f.reply,"bot"):c(s,r.i18n.error,"error")}catch(f){y(u,!1),c(s,r.i18n.error,"error"),console.error(f)}}),t&&t.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),a&&a.click())}),m&&m.addEventListener("click",()=>n.container.classList.add("aura--open")),C&&C.addEventListener("click",()=>n.container.classList.remove("aura--open")))}function b(){let e={},t=n.container;return t&&Array.from(t.attributes).forEach(a=>{if(a.name.startsWith("data-ctx-")){let s=a.name.replace("data-ctx-","").replace(/-([a-z])/g,(u,m)=>m.toUpperCase());e[s]=a.value}}),e}function q(e){let t=r.selectors;return{form:e.querySelector(t.form),input:e.querySelector(t.input),submit:e.querySelector(t.submit),messages:e.querySelector(t.messages),typingIndicator:e.querySelector(t.typingIndicator),openBtn:e.querySelector(t.openBtn),closeBtn:e.querySelector(t.closeBtn)}}function T(e){if(!e.querySelector(r.selectors.messages)){let t=d("div",{class:"aura-messages","data-aura-messages":!0,"aria-live":"polite",role:"log"});e.appendChild(t)}if(!e.querySelector(r.selectors.form)){let t=d("form",{class:"aura-form","data-aura-form":!0}),a=d("textarea",{class:"aura-input","data-aura-input":!0,placeholder:r.i18n.placeholder}),s=d("button",{type:"submit",class:"aura-submit","data-aura-submit":!0},r.i18n.sending);t.appendChild(a),t.appendChild(s),e.appendChild(t)}if(!e.querySelector(r.selectors.typingIndicator)){let t=d("div",{class:"aura-typing","data-aura-typing":!0,"aria-hidden":"true"},"");e.appendChild(t)}}function w(e,t={}){let a=typeof e=="string"?document.querySelector(e):e;if(!a)throw new Error("AuraChatbot: container not found");return l(window.AURA_CHATBOT_CONFIG||{}),l(t),n.container=a,T(a),n.elements=q(a),n.elements.messages||(n.elements.messages=a.querySelector(r.selectors.messages)||a.appendChild(d("div",{class:"aura-messages","data-aura-messages":!0}))),n.elements.input&&r.i18n&&r.i18n.placeholder&&(n.elements.input.placeholder=r.i18n.placeholder),S(),{send:s=>(c(n.elements.messages,s,"user"),h({prompt:s,context:b()}).then(u=>(u&&u.reply&&c(n.elements.messages,u.reply,"bot"),u))),container:a,config:r}}function x(e="[data-aura-chat]"){document.querySelectorAll(e).forEach(t=>{try{w(t)}catch{}})}return{init:w,autoInit:x}}();typeof window<"u"&&(window.AuraChatbot=window.AuraChatbot||E);var H=E;return j(P);})();
//# sourceMappingURL=aura-chatbot.iife.js.map
